{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block json_ld %}
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": ["ItemList", "WebPage"],
    "headline": "{{ page_title }}",
    "description": "{{ page_description }}",
    "url": "{{ og_url }}",
    "image": "{{ og_image }}",
    "datePublished": "{{ playlist.created_at | date:'Y-n-d\TH:i:s' }}",
    "dateModified": "{{ playlist.updated_at | date:'Y-n-d\TH:i:s' }}",
    "itemListOrder": "http://schema.org/ItemListOrderAscending",
    "numberOfItems": "{{ playlist.playlist_book_set.count }}",
    "author": {
        "@type": "Person",
        "name": "{{ playlist.user.username }}"
    },
    "publisher": {
        "@type": "Organization",
        "name": "BooxMix"
    },
    "itemListElement": [
        {% for playlist_book in playlist.playlist_book_set.all %}
        {
            "@type": "Book",
            "position": "{{ forloop.counter }}",
            "isbn": "{{ playlist_book.book.isbnb }}",
            "name": "{{ playlist_book.book.data.title }}",
            "image": "{{ playlist_book.book.data.cover }}",
            "url": "{{ playlist_book.book.data.affiliate_url | default_if_none:playlist_book.book.data.cover }}",
            "author": {
                "@type": "Person",
                "name": "{{ playlist_book.book.data.author }}"
            },
            "publisher": {
                "@type": "Organization",
                "name": "{{ playlist_book.book.data.publisher }}"
            }
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ]
}
</script>
{% endblock %}

{% block content %}

<div class="container">
    <section id="playlist-detail-overview">
        <h1 class="mt-4 mt-md-5 playlist-detail-title">{{ page_title }}</h1>
        <a href="{% url 'accounts:profile' playlist.user.username %}" class="color-gray text-xl mt-3">
            {{ playlist.user.username | default_if_none:'' }}
        </a>
        {% if request.user == playlist.user %}
        <div class="row">
            <div class="col-md-9">
        {% endif %}
                <p class="mt-4">{{ playlist.description | default_if_none:'' | linebreaksbr | urlize }}</p>
        {% if request.user == playlist.user %}
            </div>
            <div class="col-md-3">
                <a href="{% url 'main:playlist_update' playlist.pk %}" class="btn btn-outline-sub w-100 my-md-4">
                    {% trans 'Edit' %}
                </a>
            </div>
        </div>
        {% endif %}
        {% with text='【'|add:playlist.title|add:'】%0a'|add:playlist.description %}
        <div class="row mt-4{% if request.user == playlist.user %} mt-md-0{% endif %}">
            <div class="col-md-3 offset-md-9">
                <div class="row">
                    <div class="col-3 offset-3 col-md-4 offset-md-2 text-center">
                        <a
                            href="https://twitter.com/intent/tweet?text={{ text|truncatechars:80|iriencode }}%0a%23読書好きと繋がりたい%20%23読書%20%23BooxMix{% if playlist.theme %}%20%23{{ playlist.theme.name|urlencode }}{% endif %}&url={{ og_url|urlencode }}"
                            target="_blank"
                        >
                            <i class="fab fa-twitter fa-twitter-color fa-2x"></i>
                        </a>
                    </div>
                    <div class="col-3 col-md-4 text-center">
                        <a
                            href="https://www.facebook.com/sharer/sharer.php?u={{ og_url|urlencode }}"
                            target="_blank"
                        >
                            <i class="fab fa-facebook fa-facebook-color fa-2x"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endwith %}
    </section>

    <section id="playlist-detail-books">
        {% for playlist_book in playlist.playlist_book_set.all %}
        <div class="playlist-book-item">
            <div class="line-gray my-4"></div>
            <div class="row">
                <div class="col-5 col-sm-3 col-lg-2">
                    {% if playlist_book.book.data.cover %}
                    <img class="w-100" src="{{ playlist_book.book.data.cover | default_if_none:'' }}">
                    {% else %}
                    <div class="blank-box-wrapper no-image-wrapper">
                        <div class="blank-box-content no-image-content">
                            <div class="d-flex align-items-center h-100">
                                <span class="text-sm text-center font-weight-bold w-100">{% trans 'No Image' %}</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                <div class="col-7 col-sm-6 col-lg-7 pl-0">
                    <h2 class="text-xl">{{ forloop.counter }}. {{ playlist_book.book.data.title | default_if_none:'' }}</h2>
                    <span>{{ playlist_book.book.data.author | default_if_none:'' }}</span>
                    <p class="d-none d-sm-block mt-4">{{ playlist_book.description | default_if_none:'' | linebreaksbr | urlize }}</p>
                    {% if playlist_book.book.data.affiliate_url %}
                    <a href="{{ playlist_book.book.data.affiliate_url | default_if_none:'' }}" target=”_blank” class="btn btn-main d-sm-none w-100 mt-4 mt-sm-0">
                        {% trans 'Show more' %}
                    </a>
                    {% endif %}
                </div>
                {% if playlist_book.book.data.affiliate_url %}
                <div class="col-sm-3 d-none d-sm-block">
                    <a href="{{ playlist_book.book.data.affiliate_url | default_if_none:'' }}" target=”_blank” class="btn btn-main w-100">
                        {% trans 'Show more' %}
                    </a>
                </div>
                {% endif %}
            </div>
            <p class="mt-3 d-sm-none">{{ playlist_book.description | default_if_none:'' | linebreaksbr | urlize }}</p>
        </div>
        {% endfor %}
    </section>

    <section id="playlist-detail-user">
        <h2 class="mt-5">{% trans 'Who created this playlist?' %}</h2>
        <div class="bg-gray border-radius px-2 py-3 mt-4">

            <h3>
                <a href="{% url 'accounts:profile' playlist.user.username %}" class="color-gray text-lg mt-3">
                    {{ playlist.user.username | default_if_none:'' }}
                </a>
            </h3>
            <p class="mb-0">{{ playlist.user.comment | default_if_none:'' }}</p>
        </div>
    </section>

    <section id="playlist-defailt-others">
        <div class="line-gray my-5"></div>
        <h2>
            {% if playlist.theme %}
            {% trans 'Playlists with same theme' %}
            {% else %}
            {% trans 'These are also recommended' %}
            {% endif %}
        </h2>
        {% include 'main/playlists/layouts/list-widget-small.html' with playlists=other_playlists %}
        <a href="{% url 'main:playlist' %}{% if playlist.theme %}?theme={{ playlist.theme.slug }}{% endif %}" class="btn btn-outline-sub w-100 d-md-none my-3">
            {% blocktrans %}Show all{% endblocktrans %}&nbsp;<i class="fas fa-chevron-right"></i>
        </a>
        <a href="{% url 'main:playlist' %}{% if playlist.theme %}?theme={{ playlist.theme.slug }}{% endif %}" class="btn btn-inline-sub d-none d-md-inline-block mt-3">
            {% if playlist.theme %}
            {% blocktrans with playlist.theme.name as theme %}Show all {{ theme }}{% endblocktrans %}&nbsp;<i class="fas fa-chevron-right"></i>
            {% else %}
            {% blocktrans with playlist.theme.name as theme %}Show more playlists{% endblocktrans %}&nbsp;<i class="fas fa-chevron-right"></i>
            {% endif %}
        </a>
    </section>

    <section id="playlist-detail-lets-create">
        <div class="mt-5">
            {% include 'main/playlists/layouts/lets-create-playlist.html' with theme=playlist.theme %}
        </div>
    </section>
</div>

{% endblock %}
